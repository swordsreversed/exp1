{% extends "base.njk" %}

{% block content %}

{% include "_header.njk" %}
  <span style="margin-left: 4px;"><a href="about">More Info</a></span>


{# {{ images | dump }} #}
{% for image in images %}
  {# {% set imges = image.url | split(".") %} #}

  <img title = "" id="{{loop.index0}}" class="imgSty midsize draggable hidden" src="{{image.url}}"/>


{% endfor %}

{# <div class="draggable video" title = "">
  <iframe width="250" src="https://www.youtube.com/embed/YibFHWZ66GQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe>
</div>
<div class="draggable video" title = "">
  <audio controls src="https://file-examples-com.github.io/uploads/2017/11/file_example_MP3_1MG.mp3"/>
</div> #}

{% endblock %}
{% block script %}

  let dots = []
  let  mouse = {
      x: 0,
      y: 0
    };

  var Dot = function() {
    this.x = 0;
    this.y = 0;
    this.node = (function(){
      var n = document.createElement("div");
      n.className = "trail";
      document.body.appendChild(n);
      return n;
    }());
  };

  Dot.prototype.draw = function() {
    this.node.style.left = this.x + "px";
    this.node.style.top = this.y + "px";
  };

  for (var i = 0; i < 12; i++) {
    var d = new Dot();
    dots.push(d);
  }

  // This is the screen redraw function
function draw() {
  // Make sure the mouse position is set everytime
    // draw() is called.
  var x = mouse.x,
      y = mouse.y;
  
  // This loop is where all the 90s magic happens
  dots.forEach(function(dot, index, dots) {
    var nextDot = dots[index + 1] || dots[0];
    
    dot.x = x;
    dot.y = y;
    dot.draw();
    x += (nextDot.x - dot.x) * .6;
    y += (nextDot.y - dot.y) * .6;

  });
}

function animate(toggle) {
  if (toggle) {
    draw();
    requestAnimationFrame(animate);
  }
}

addEventListener("mousemove", function(event) {
  //event.preventDefault();
  mouse.x = event.pageX;
  mouse.y = event.pageY;
});

let contn = [ 
  {% for image in images %}

  [{{loop.index0}}, "{{image.description | safe }}", "{{image.alt | safe}}", "{{image.caption | safe}}"],

{% endfor %}
];

  $( function() {
    
    let ww = $(window).width();
    let wh = $(window).height();

    $( ".draggable" ).each(function( index ) {
      let posit = getRandomNumber(ww, wh);
      $(this).css('left', posit[0] + "px")
      $(this).css('top', posit[1]+ "px")
      $(this).removeClass('hidden')
    }); 

    $( ".draggable" ).draggable({
      start: function(e) {
        console.log('currentTarget', e.currentTarget)
        $( ".draggable" ).each(function( index ) {
          $(this).css("z-index", "1");
        });
        $(this).css("z-index", "1010");
  
      },
      drag: function() {
     
      },
      stop: function() {
      }
    });
  
    $( ".video" ).each(function( index ) {
        let randomColor = '#'+ Math.floor(Math.random() * 19777215).toString(16);
        $(this).css("background-color", randomColor);
    });


   $( ".draggable" ).tooltip({
        open: function( event, ui ) {
          let cid = event.currentTarget.id;
          let res = contn[cid][2] + "<br/>" + contn[cid][3] + "<br/>" + contn[cid][1];
          $( this ).tooltip( "option", "content", res );

        },
        content: 'test',
        position: { of: "body", at: "left top+120px" }
    });

   
  //animate(true);

 });

function getRandomNumber(ww, wh) {
  let posx = Math.round(Math.random() * ww)-20;
  let posy = Math.round(Math.random() * wh)-20;
	return [posx, posy]
}

{% endblock %}